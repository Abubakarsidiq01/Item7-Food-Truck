{% extends "staff_layout.html" %}
{% block staff_content %}

<section class="orders-header">
    <div class="orders-header-content">
        <h1 class="orders-title">Customer Orders</h1>
        <p class="orders-subtitle">Manage and process all customer orders</p>
    </div>
</section>

<!-- Date Filter -->
<section class="date-filter-section">
    <div class="date-filter-container">
        <h2>Filter by Date</h2>
        <div class="date-buttons">
            <a href="{{ url_for('staff_orders') }}" class="date-btn {% if not selected_date %}active{% endif %}">
                All Orders
            </a>
            {% for date_key in sorted_dates %}
            <a href="{{ url_for('staff_orders', date=date_key) }}" class="date-btn {% if selected_date == date_key %}active{% endif %}">
                {{ orders_by_date[date_key].display }}
            </a>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Orders List -->
<section class="orders-list-section">
    {% if orders %}
        <div class="orders-grid">
            {% for order in orders %}
            <div class="order-card {% if order.status == 'Completed' %}completed{% elif order.is_safe == 'NO' %}unsafe{% else %}pending{% endif %}">
                <div class="order-header">
                    <div class="order-id">
                        <strong>Order #{{ order.order_id }}</strong>
                        <span class="order-status status-{{ order.status|lower }}">{{ order.status }}</span>
                    </div>
                    <div class="order-time">
                        {% set order_datetime = order.timestamp|string %}
                        {% if 'T' in order_datetime %}
                            {% set dt = order_datetime.split('T') %}
                            {{ dt[0] }} at {{ dt[1][:5] }}
                        {% else %}
                            {{ order.timestamp }}
                        {% endif %}
                    </div>
                </div>
                
                <div class="order-body">
                    <div class="order-customer">
                        <p><strong>{{ order.customer_name }}</strong></p>
                        <p class="customer-email">{{ order.customer_email }}</p>
                    </div>
                    
                    <div class="order-items">
                        <p class="order-label">Items:</p>
                        <p class="order-value">{{ order.item }}</p>
                    </div>
                    
                    <div class="order-price">
                        <p class="order-label">Total:</p>
                        <p class="order-value price">${{ "%.2f"|format(order.price|float) }}</p>
                    </div>
                    
                    {% if order.allergy_info and order.allergy_info != 'no allergic' and order.allergy_info != 'N/A' %}
                    <div class="order-allergy {% if order.is_safe == 'NO' %}allergy-unsafe{% else %}allergy-safe{% endif %}">
                        <p class="order-label">
                            <svg style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 4px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            Allergy Info:
                        </p>
                        <p class="order-value">{{ order.allergy_info }}</p>
                        {% if order.is_safe == 'NO' %}
                        <span class="allergy-warning">⚠️ May not be safe</span>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    {% if order.completed_by %}
                    <div class="order-completed">
                        <p class="order-label">Completed by:</p>
                        <p class="order-value">{{ order.completed_by }}</p>
                    </div>
                    {% endif %}
                </div>
                
                {% if order.status != 'Completed' %}
                <div class="order-actions">
                    <form method="POST" action="{{ url_for('complete_order') }}" style="margin: 0;">
                        <input type="hidden" name="order_id" value="{{ order.order_id }}">
                        <button type="submit" class="complete-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Mark as Completed
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="orders-empty">
            <svg style="width: 80px; height: 80px; margin: 0 auto 20px; display: block; color: #ddd;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg>
            <p>No orders found{% if selected_date %} for this date{% endif %}.</p>
        </div>
    {% endif %}
</section>

{% endblock %}

